# =============================================
# RENDER BLUEPRINT - PROMPTY CHALLENGE
# Deploy: Dashboard → New Blueprint → Connect repo
# =============================================

services:
  # ==========================================
  # BACKEND - FastAPI Python Service
  # ==========================================
  - type: web
    name: prompty-backend
    runtime: python
    rootDir: backend
    region: oregon
    plan: free

    # Build & Start Commands
    buildCommand: pip install -r requirements.txt
    startCommand: uvicorn main:app --host 0.0.0.0 --port $PORT

    # Health Check - Use existing endpoint
    healthCheckPath: /health

    # Environment Variables
    envVars:
      # ========================================
      # DATABASE - Auto-populated from database
      # ========================================
      - key: DATABASE_URL
        fromDatabase:
          name: prompty-db
          property: connectionString

      # ========================================
      # JWT AUTHENTICATION - Set manually
      # ========================================
      - key: JWT_SECRET
        # ⚠️ SET THIS MANUALLY IN RENDER DASHBOARD
        # Value: A random string (e.g., openssl rand -hex 32)

      - key: JWT_ALGORITHM
        value: HS256

      - key: JWT_EXPIRE_HOURS
        value: "6"

      # ========================================
      # GROQ AI API - Set manually with your key
      # ========================================
      - key: GROQ_API_KEY
        # ⚠️ SET THIS MANUALLY IN RENDER DASHBOARD
        # Get from: console.groq.com

      - key: GROQ_MODEL
        value: llama-3.3-70b-versatile

      - key: GROQ_TIMEOUT
        value: "30"

      # ========================================
      # CORS - Frontend URL
      # ========================================
      - key: CORS_ORIGINS
        value: http://localhost:3000,https://prompty-frontend.onrender.com

      # ========================================
      # SERVER CONFIG
      # ========================================
      - key: DEBUG
        value: "false"

      - key: LOG_LEVEL
        value: INFO

      - key: NODE_ENV
        value: production

      # ========================================
      # ADMIN CREDENTIALS - Set manually
      # ========================================
      - key: ADMIN_USERNAME
        value: admin

      - key: ADMIN_PASSWORD
        # ⚠️ SET THIS MANUALLY IN RENDER DASHBOARD
        # Use a strong password

      # ========================================
      # RATE LIMITING
      # ========================================
      - key: RATE_LIMIT_PER_MINUTE
        value: "10"

      # ========================================
      # EVENT CONFIG
      # ========================================
      - key: EVENT_NAME
        value: "Prompty Challenge"

      - key: MAX_CONCURRENT_USERS
        value: "60"

  # ==========================================
  # FRONTEND - Next.js Web Service
  # ==========================================
  - type: web
    name: prompty-frontend
    runtime: node
    rootDir: frontend
    region: oregon
    plan: free

    # Build & Start
    buildCommand: npm install && npm run build
    startCommand: npm run start

    # Health Check
    healthCheckPath: /

    # Environment Variables
    envVars:
      # ========================================
      # API URL - Points to backend
      # ========================================
      - key: NEXT_PUBLIC_API_URL
        value: https://prompty-backend.onrender.com

      # ========================================
      # ENVIRONMENT
      # ========================================
      - key: NODE_ENV
        value: production

# ==========================================
# DATABASE - PostgreSQL
# ==========================================
databases:
  - name: prompty-db
    plan: free
    region: oregon
    databaseName: prompty
    user: prompty_user
